<!DOCTYPE html>
<html>
<head>
    <title>All Movies</title>
</head>
<body>

<h1>All Movies</h1>
<p><a href="/api/users/logout">Logout</a></p>

<h2>Add a Movie</h2>
<form action="/api/movies" method="POST">
    <input type="text" name="title" placeholder="Movie Title" required><br><br>
    <input type="number" name="year" placeholder="Year" min="1880" max="2100" required><br><br>
    <textarea name="description" placeholder="Description" required></textarea><br><br>
    <button type="submit">Add Movie</button>
</form>

<h2>Movies</h2>
<ul>
    <% movies.forEach(movie => { %>
        <li>
            <h3>
            <a href="/movies/<%= movie.id %>"><%= movie.title %></a> 
            (<%= movie.year %>)
            </h3>
            <p><%= movie.description %></p>

            <% if (movie.reviews.length > 0) { %>
                <p>
                    Average Rating:
                    <%= (
                        movie.reviews.reduce((a,b)=>a+b.rating,0) /
                        movie.reviews.length
                    ).toFixed(1) %>
                    ( <%= movie.reviews.length %> reviews )
                </p>
            <% } else { %>
                <p>No reviews yet</p>
            <% } %>

        </li>
    <% }) %>
</ul>

</body>
</html>
